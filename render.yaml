# Render Blueprint - Car Rental Backend Microservices
# https://render.com/docs/blueprint-spec
#
# IMPORTANT: On Render free tier, services communicate via PUBLIC URLs
# The URLs below assume your services will be named as specified

services:
  # ========================================
  # API GATEWAY - Public facing
  # ========================================
  - type: web
    name: car-rental-gateway
    runtime: docker
    dockerfilePath: packages/gateway/Dockerfile
    dockerContext: .
    region: oregon
    plan: free
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: LOG_LEVEL
        value: info
      - key: FRONTEND_URL
        value: http://localhost:5173
      - key: JWT_SECRET
        sync: false
      - key: RATE_LIMIT_MAX
        value: 100
      - key: RATE_LIMIT_WINDOW
        value: 15m
      - key: AUTH_SERVICE_URL
        value: https://car-rental-auth.onrender.com
      - key: CAR_SERVICE_URL
        value: https://car-rental-car.onrender.com
      - key: SEARCH_SERVICE_URL
        value: https://car-rental-search.onrender.com
      - key: BOOKING_SERVICE_URL
        value: https://car-rental-booking.onrender.com
      - key: NOTIFICATION_SERVICE_URL
        value: https://car-rental-notification.onrender.com

  # ========================================
  # AUTH SERVICE
  # ========================================
  - type: web
    name: car-rental-auth
    runtime: docker
    dockerfilePath: packages/auth-service/Dockerfile
    dockerContext: .
    region: oregon
    plan: free
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3001
      - key: LOG_LEVEL
        value: info
      - key: DATABASE_URL
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: JWT_EXPIRY
        value: 15m
      - key: REFRESH_SECRET
        sync: false
      - key: REFRESH_EXPIRY
        value: 7d
      - key: BCRYPT_ROUNDS
        value: 12

  # ========================================
  # CAR SERVICE
  # ========================================
  - type: web
    name: car-rental-car
    runtime: docker
    dockerfilePath: packages/car-service/Dockerfile
    dockerContext: .
    region: oregon
    plan: free
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3002
      - key: LOG_LEVEL
        value: info
      - key: DATABASE_URL
        sync: false
      - key: ELASTICSEARCH_URL
        sync: false
      - key: SEARCH_SERVICE_URL
        value: https://car-rental-search.onrender.com

  # ========================================
  # SEARCH SERVICE
  # ========================================
  - type: web
    name: car-rental-search
    runtime: docker
    dockerfilePath: packages/search-service/Dockerfile
    dockerContext: .
    region: oregon
    plan: free
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3003
      - key: LOG_LEVEL
        value: info
      - key: ELASTICSEARCH_URL
        sync: false
      - key: CAR_SERVICE_URL
        value: https://car-rental-car.onrender.com
      - key: BOOKING_SERVICE_URL
        value: https://car-rental-booking.onrender.com

  # ========================================
  # BOOKING SERVICE
  # ========================================
  - type: web
    name: car-rental-booking
    runtime: docker
    dockerfilePath: packages/booking-service/Dockerfile
    dockerContext: .
    region: oregon
    plan: free
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3004
      - key: LOG_LEVEL
        value: info
      - key: DATABASE_URL
        sync: false
      - key: CAR_SERVICE_URL
        value: https://car-rental-car.onrender.com

  # ========================================
  # NOTIFICATION SERVICE
  # ========================================
  - type: web
    name: car-rental-notification
    runtime: docker
    dockerfilePath: packages/notification-service/Dockerfile
    dockerContext: .
    region: oregon
    plan: free
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3005
      - key: LOG_LEVEL
        value: info
      - key: SENDGRID_API_KEY
        sync: false

# ========================================
# SECRETS TO SET MANUALLY AFTER DEPLOYMENT
# ========================================
# Go to each service's Environment tab and set:
#
# car-rental-auth:
#   DATABASE_URL = postgresql://car_rental_db_tsoo_user:xxx@dpg-xxx.oregon-postgres.render.com/car_rental_db_tsoo
#   JWT_SECRET = CVaA77s/xmKLEg1i6567k2ypwBtS3c9FkQtTO5K1lHI=
#   REFRESH_SECRET = j7Ord0zhYuMKNMB54m2Ap8iLHOhHyOP2BjCjUyqtqfU=
#
# car-rental-car:
#   DATABASE_URL = (same as auth)
#   ELASTICSEARCH_URL = https://user:pass@your-bonsai-url.bonsaisearch.net
#
# car-rental-search:
#   ELASTICSEARCH_URL = (same as car)
#
# car-rental-booking:
#   DATABASE_URL = (same as auth)
#
# car-rental-gateway:
#   JWT_SECRET = (same as auth)
#
# car-rental-notification:
#   SENDGRID_API_KEY = your-api-key (optional)
